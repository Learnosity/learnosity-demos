(()=>{var t={27:t=>{var e,n,r;!function(){var t=window.URL||window.webkitURL,a=window.Blob;if(!t||!a)throw new Error("This browser does not support AudioSynth");var i=!1,o=null,s=function(t,e){return[new Uint8Array([e,e>>8]),new Uint8Array([e,e>>8,e>>16,e>>24])][t]},u=function(t,e,n,r){Object.defineProperty(this,t,{value:e,writable:!!n,enumerable:!!r})},l=function(t,e,n){u.call(this,t,e,n,!0)};r=function(){this.__init__.apply(this,arguments)};var c=u.bind(r.prototype),h=l.bind(r.prototype);c("__init__",(function(t,e,n){if(!i)throw new Error("AudioSynthInstrument can only be instantiated from the createInstrument method of the AudioSynth object.");u.call(this,"_parent",t),l.call(this,"name",e),u.call(this,"_soundID",n)})),h("play",(function(t,e,n){return this._parent.play(this._soundID,t,e,n)})),h("generate",(function(t,e,n){return this._parent.generate(this._soundID,t,e,n)})),c=u.bind((n=function t(){return o instanceof t?o:(this.__init__(),this)}).prototype),h=l.bind(n.prototype),c("_debug",!1,!0),c("_bitsPerSample",16),c("_channels",1),c("_sampleRate",44100,!0),h("setSampleRate",(function(t){return this._sampleRate=Math.max(Math.min(0|t,44100),4e3),this._clearCache(),this._sampleRate})),h("getSampleRate",(function(){return this._sampleRate})),c("_volume",32768,!0),h("setVolume",(function(t){return t=parseFloat(t),isNaN(t)&&(t=0),t=Math.round(32768*t),this._volume=Math.max(Math.min(0|t,32768),0),this._clearCache(),this._volume})),h("getVolume",(function(){return Math.round(this._volume/32768*1e4)/1e4})),c("_notes",{C:261.63,"C#":277.18,D:293.66,"D#":311.13,E:329.63,F:349.23,"F#":369.99,G:392,"G#":415.3,A:440,"A#":466.16,B:493.88}),c("_fileCache",[],!0),c("_temp",{},!0),c("_sounds",[],!0),c("_mod",[function(t,e,n,r){return Math.sin(2*Math.PI*(t/e)*n+r)}]),c("_resizeCache",(function(){for(var t=this._fileCache,e=this._sounds.length;t.length<e;){for(var n=[],r=0;r<8;r++){var a={};for(var i in this._notes)a[i]={};n.push(a)}t.push(n)}})),c("_clearCache",(function(){this._fileCache=[],this._resizeCache()})),h("generate",(function(e,n,r,i){var o=this._sounds[e];if(!o)for(var u=0;u<this._sounds.length;u++)if(this._sounds[u].name==e){o=this._sounds[u],e=u;break}if(!o)throw new Error("Invalid sound or sound ID: "+e);var l=(new Date).valueOf();this._temp={},r|=0,r=Math.min(8,Math.max(1,r));var c=i?parseFloat(i):2;if(void 0===this._notes[n])throw new Error(n+" is not a valid note.");if(void 0!==this._fileCache[e][r-1][n][c])return this._debug&&console.log((new Date).valueOf()-l,"ms to retrieve (cached)"),this._fileCache[e][r-1][n][c];var h=this._notes[n]*Math.pow(2,r-4),f=this._sampleRate,d=this._volume,v=this._channels,p=this._bitsPerSample,m=o.attack(f,h,d),y=o.dampen(f,h,d),g=o.wave,_={modulate:this._mod,vars:this._temp},w=0,b=new Uint8Array(new ArrayBuffer(Math.ceil(f*c*2))),M=f*m|0,A=f*c|0;for(u=0;u!==M;u++)w=d*(u/(f*m))*g.call(_,u,f,h,d),b[u<<1]=w,b[1+(u<<1)]=w>>8;for(;u!==A;u++)w=d*Math.pow(1-(u-f*m)/(f*(c-m)),y)*g.call(_,u,f,h,d),b[u<<1]=w,b[1+(u<<1)]=w>>8;var S=["RIFF",s(1,52),"WAVE","fmt ",s(1,16),s(0,1),s(0,v),s(1,f),s(1,f*v*p/8),s(0,v*p/8),s(0,p),"data",s(1,b.length*v*p/8),b],I=new a(S,{type:"audio/wav"}),C=t.createObjectURL(I);return this._fileCache[e][r-1][n][c]=C,this._debug&&console.log((new Date).valueOf()-l,"ms to generate"),C})),h("play",(function(t,e,n,r){var a=this.generate(t,e,n,r),i=new Audio(a);return i.play(),i})),h("debug",(function(){this._debug=!0})),h("createInstrument",(function(t){var e=0,n=!1;if("string"==typeof t){for(var a=0;a<this._sounds.length;a++)if(this._sounds[a].name==t){n=!0,e=a;break}}else this._sounds[t]&&(e=t,t=this._sounds[e].name,n=!0);if(!n)throw new Error("Invalid sound or sound ID: "+t);i=!0;var o=new r(this,t,e);return i=!1,o})),h("listSounds",(function(){for(var t=[],e=0;e<this._sounds.length;e++)t.push(this._sounds[e].name);return t})),c("__init__",(function(){this._resizeCache()})),h("loadSoundProfile",(function(){for(var t=0,e=arguments.length;t<e;t++){var n=arguments[t];if(!(n instanceof Object))throw new Error("Invalid sound profile.");this._sounds.push(n)}return this._resizeCache(),!0})),h("loadModulationFunction",(function(){for(var t=0,e=arguments.length;t<e;t++){var n=arguments[t];if("function"!=typeof n)throw new Error("Invalid modulation function.");this._mod.push(n)}return!0})),o=new n,e=o}(),e.loadModulationFunction((function(t,e,n,r){return 1*Math.sin(2*Math.PI*(t/e*n)+r)}),(function(t,e,n,r){return 1*Math.sin(4*Math.PI*(t/e*n)+r)}),(function(t,e,n,r){return 1*Math.sin(8*Math.PI*(t/e*n)+r)}),(function(t,e,n,r){return 1*Math.sin(.5*Math.PI*(t/e*n)+r)}),(function(t,e,n,r){return 1*Math.sin(.25*Math.PI*(t/e*n)+r)}),(function(t,e,n,r){return.5*Math.sin(2*Math.PI*(t/e*n)+r)}),(function(t,e,n,r){return.5*Math.sin(4*Math.PI*(t/e*n)+r)}),(function(t,e,n,r){return.5*Math.sin(8*Math.PI*(t/e*n)+r)}),(function(t,e,n,r){return.5*Math.sin(.5*Math.PI*(t/e*n)+r)}),(function(t,e,n,r){return.5*Math.sin(.25*Math.PI*(t/e*n)+r)})),e.loadSoundProfile({name:"piano",attack:function(){return.002},dampen:function(t,e,n){return Math.pow(.5*Math.log(e*n/t),2)},wave:function(t,e,n,r){var a=this.modulate[0];return this.modulate[1](t,e,n,Math.pow(a(t,e,n,0),2)+.75*a(t,e,n,.25)+.1*a(t,e,n,.5))}},{name:"organ",attack:function(){return.3},dampen:function(t,e){return 1+.01*e},wave:function(t,e,n){var r=this.modulate[0];return this.modulate[1](t,e,n,r(t,e,n,0)+.5*r(t,e,n,.25)+.25*r(t,e,n,.5))}},{name:"acoustic",attack:function(){return.002},dampen:function(){return 1},wave:function(t,e,n){var r=this.vars;r.valueTable=r.valueTable?r.valueTable:[],void 0===r.playVal&&(r.playVal=0),void 0===r.periodCount&&(r.periodCount=0);var a=r.valueTable,i=r.playVal,o=r.periodCount,s=e/n,u=Math.floor(100*(s-Math.floor(s))),l=!1;if(a.length<=Math.ceil(s))return a.push(2*Math.round(Math.random())-1),a[a.length-1];a[i]=.5*(a[i>=a.length-1?0:i+1]+a[i]),i>=Math.floor(s)&&(i<Math.ceil(s)?o%100>=u&&(l=!0,a[i+1]=.5*(a[0]+a[i+1]),r.periodCount++):l=!0);var c=a[i];return l?r.playVal=0:r.playVal++,c}},{name:"edm",attack:function(){return.002},dampen:function(){return 1},wave:function(t,e,n){var r=this.modulate[0],a=this.modulate.slice(1);return a[0](t,e,n,a[9](t,e,n,a[2](t,e,n,Math.pow(r(t,e,n,0),3)+Math.pow(r(t,e,n,.5),5)+Math.pow(r(t,e,n,1),7)))+a[8](t,e,n,r(t,e,n,1.75)))}}),t.exports={Synth:e,AudioSynth:n,AudioSynthInstrument:r}}},e={};function n(r){var a=e[r];if(void 0!==a)return a.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}(()=>{"use strict";var t="lrn-piano";function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var a=function(){function t(e,n,r){var a=r.question,i=r.response;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.el=e,this.range=n,this.question=a,this.response=i,this.notes=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B","C","C#","D","D#","E","F","F#","G","G#","A","A#","B"]}var n,a;return n=t,(a=[{key:"render",value:function(){var t=document.createElement("div");t.classList.add("keyboard"),this.el.appendChild(t);var n,r=function(t,n){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,n){if(t){if("string"==typeof t)return e(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){r&&(t=r);var a=0,i=function(){};return{s:i,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){u=!0,o=t},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw o}}}}(this.notes);try{for(r.s();!(n=r.n()).done;){var a=n.value,i=document.createElement("div");i.classList.add("key"),a.includes("#")?i.classList.add("blackKey"):i.classList.add("whiteKey"),"C"!==a&&"F"!==a||i.classList.add("no-offset"),t.appendChild(i)}}catch(t){r.e(t)}finally{r.f()}}}])&&r(n.prototype,a),t}(),i=n(27),o=function(t){return t.map((function(t){var e=t.indexOf("_")+1;return Number(t.substring(e,t.length))}))},s=function(t,e){if(t.notes&&t.indecies)return t.notes.forEach((function(n,r){var a=t.indecies[r],i="".concat(n,"_").concat(a);e.push(i)})),e};function u(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||l(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){if(t){if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function h(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var f=function(){function e(t,n){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.init=t,this.events=t.events,this.lrnUtils=n,this.el=t.$el.get(0),this.render().then((function(){r.registerPublicMethods(),r.handleEvents();var e=t.getFacade();"review"===t.state&&(e.updateUI(),e.disable()),"resume"===t.state&&e.updateUI(),t.events.trigger("ready")}))}var n,r;return n=e,(r=[{key:"render",value:function(){var e=this,n=this.el,r=this.init,o=this.lrnUtils,s=r.question,u=r.response;return n.innerHTML='\n            <div class="'.concat(t,' lrn-response-validation-wrapper">\n                <div class="lrn_response_input">    \n                    <div class="piano-widget"></div>       \n                </div>            \n                <div class="').concat(t,'-checkAnswer-wrapper"></div>\n                <div class="').concat(t,'-suggestedAnswers-wrapper"></div>\n            </div>\n        '),Promise.all([o.renderComponent("SuggestedAnswersList",n.querySelector(".".concat(t,"-suggestedAnswers-wrapper"))),o.renderComponent("CheckAnswerButton",n.querySelector(".".concat(t,"-checkAnswer-wrapper")))]).then((function(t){var r,o,c=(r=t,o=1,function(t){if(Array.isArray(t))return t}(r)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(t);!(o=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);o=!0);}catch(t){s=!0,a=t}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}(r,o)||l(r,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0];e.suggestedAnswersList=c,e.piano=new a(n.querySelector(".piano-widget"),null,{question:s,response:u}),e.piano.render(),i.Synth.setVolume(.3)}))}},{key:"registerPublicMethods",value:function(){var t=this.init,e=this.el,n=this.piano,r=t.getFacade();r.disable=function(){[].concat(u(r.getKeys()),[e.querySelector(".keyboard")]).forEach((function(t){t.classList.add("disabled")})),n.disabled=!0},r.enable=function(){n.disabled=!1},r.updateUI=function(){var t=r.getResponse();if(t&&t.value.indecies){var e=r.getKeys(),n=r.getResponse().value.indecies;e.forEach((function(t,e){n.includes(e)&&t.classList.toggle("selected")}))}},r.getKeys=function(){var t=e.querySelectorAll(".key");return Array.from(t)},r.getSelectedKeys=function(){var t=e.querySelectorAll(".selected");return Array.from(t)}}},{key:"handleEvents",value:function(){var t=this.el,e=this.events,n=this.init,r=this.piano,a=this.suggestedAnswersList,l=n.getFacade(),c=l.getKeys(),h=[];if("resume"===n.state){var f=l.getResponse();f&&s(f.value,h)}for(var d=function(s){var f=c[s],d=r.notes[s];f.addEventListener("click",(function(){if("review"!==n.state){a&&a.reset(),[].concat(u(l.getSelectedKeys()),[t.querySelector(".lrn_response_input")]).forEach((function(t){t.classList.remove("lrn_correct"),t.classList.remove("lrn_incorrect")})),s<12?i.Synth.play("piano",d,3,2):i.Synth.play("piano",d,4,2),f.classList.toggle("selected");var r="".concat(d,"_").concat(s);-1===h.indexOf(r)?h.push(r):h=h.filter((function(t){return t!==r}));var c,v={notes:(c=h,c.map((function(t){var e=t.indexOf("_");return t.substring(0,e)}))),indecies:o(h)};e.trigger("changed",v)}}))},v=0;v<r.notes.length;v++)d(v);this.events.on("validate",(function(e){var n,r=l.isValid();if(n=r,[].concat(u(l.getSelectedKeys()),[t.querySelector(".lrn_response_input")]).forEach((function(t){n?t.classList.add("lrn_correct"):t.classList.add("lrn_incorrect")})),!r&&e.showCorrectAnswers&&a){var i=l.getQuestion().valid_response,o=s(i,[]).sort((function(t,e){var n=t.indexOf("_")+1;if(Number(t.substring(n,t.length))<Number(e.substring(n,e.length)))return-1})).map((function(t){return t.substring(0,t.indexOf("_"))}));a.reset(),a.setAnswers(o.map((function(t){return{label:t}})))}}))}}])&&h(n.prototype,r),e}();LearnosityAmd.define([],(function(){return{Question:f}}))})()})();